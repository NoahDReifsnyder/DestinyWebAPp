import json
import sqlite3
from aiohttp import web
import aiobungie
from webApp.destiny_helpers import *
from webApp.auth import router
from multiprocessing.pool import ThreadPool



class Loadout:
    def __init__(self, name, character_id, items):
        self.name = name
        self.character_id = character_id
        self.items = items


class Item:
    def __init__(self, item_hash, item_instance_id, state, plugs=[]):
        self.item_hash = item_hash
        self.item_instance_id = item_instance_id
        self.state = state
        self.plugs = plugs

class Plug:
    def __init__(self, plug_hash, plug_instance_id, state):
        self.plug_hash = plug_hash


# Initialize SQLite database for loadouts

# Save a loadout to the database
def save_loadout(conn, name, character_id, items, membership_id):
    return


# Load all loadouts for a user from the database
def load_loadouts(conn, membership_id):
    return


# Fetch equipped items for a character
async def fetch_equipped_items(client, membership_type, membership_id, character_id, access_token):
    async with client.acquire() as rest:
        profile = await rest.fetch_profile(
            membership_type,
            membership_id,
            components=[aiobungie.ComponentType.CHARACTER_EQUIPMENT],
            access_token=access_token
        )
        character_equipment = profile.characters[character_id].equipment
        return [item.item_hash for item in character_equipment]


# Save in-game loadout to the app
async def save_in_game_loadout(client, conn, membership_type, membership_id, character_id, loadout_name, access_token):
    items = await fetch_equipped_items(client, membership_type, membership_id, character_id, access_token)
    save_loadout(conn, loadout_name, character_id, items, membership_id)
    print(f"Loadout '{loadout_name}' saved.")


# Equip items from a loadout
async def equip_items(client, character_id, item_ids, access_token):
    async with client.acquire() as rest:
        for item_id in item_ids:
            await rest.equip_item(character_id, item_id, access_token=access_token)


# Apply a saved loadout
async def apply_loadout(client, loadout, access_token):
    await equip_items(client, loadout["character_id"], loadout["items"], access_token)
    print(f"Loadout '{loadout['name']}' applied.")


@router.get("/loadout_landing")
async def loadout_landing(request: web.Request) -> web.Response:
    mem_id = request.query.get("mem_id")
    # get char ids, and provide user with a choice of their characters
    app = request.app
    client: aiobungie.RESTPool = request.app["client"]
    access_token = request.app["users"][mem_id]["access_token"]

    async with client.acquire() as rest:
        if not (user := app['users'][mem_id].get("user")):
            app['users'][mem_id]["user"] = user = await rest.fetch_current_user_memberships(access_token)
        if not "c_ids" in user:
            profile = await rest.fetch_profile(
                user["destinyMemberships"][0]["membershipId"],
                aiobungie.MembershipType.ALL,
                [
                    aiobungie.ComponentType.PROFILE,
                ],
                access_token)
            user["c_ids"] = character_ids = profile['profile']['data']['characterIds']
        else:
            character_ids = user["c_ids"]
        class_names = {}
        manifest = request.app["manifest"]
        for c_id in character_ids:
            user[c_id] = {}
            character = await rest.fetch_character(
                user["destinyMemberships"][0]["membershipId"],
                user["destinyMemberships"][0]["membershipType"],
                c_id,
                [
                    aiobungie.ComponentType.CHARACTERS,
                ],
                access_token
            )
            user[c_id]['class'] = \
                class_name = \
                manifest['DestinyClassDefinition'][str(character['character']['data']['classHash'])][
                    'displayProperties'][
                    'name']
            html = "<html><body>{body}</body></html>"
            mem_id_str = "mem_id=" + mem_id
            body = ""
            a_template = "<a href='/loadout?c_id={class_id}&" + mem_id_str + "'>{class_name}</a>"
        for c_id, name in [(c_id, user[c_id]['class']) for c_id in character_ids]:
            body += a_template.format(class_name=name, class_id=c_id)
        return web.Response(text=html.format(body=body), content_type='text/html')


# Loadout management router
@router.get("/loadout")
async def loadouts(request: web.Request) -> web.Response:
    mem_id = request.query.get("mem_id")
    c_id = request.query.get("c_id")
    if not mem_id:
        return web.json_response({"error": "membership_id is required"}, status=400)
    if not c_id:
        return web.json_response({"error": "character_id is required"}, status=400)
    app = request.app
    client: aiobungie.RESTPool = request.app["client"]
    access_token = request.app["users"][mem_id]["access_token"]

    # Example: Fetch and save a loadout
    membership_type = aiobungie.MembershipType.STEAM  # Replace with your membership type
    async with client.acquire() as rest:
        if not (user := app['users'][mem_id].get("user")):
            app['users'][mem_id]["user"] = user = await rest.fetch_current_user_memberships(access_token)
        loadout = await rest.fetch_profile(
            user["destinyMemberships"][0]["membershipId"],
            user["destinyMemberships"][0]["membershipType"],
            [
                aiobungie.ComponentType.CHARACTER_LOADOUTS,
                aiobungie.ComponentType.CHARACTER_EQUIPMENT
            ],
            access_token)

    #print(loadout)
    l = loadout['characterLoadouts']['data'][c_id]['loadouts'][0]
    current = loadout['characterEquipment']['data'][c_id]['items']
    item_ids = [x['itemInstanceId'] for x in l['items']]
    #equip all the items but use threads
    item_hashes = {}
    items_to_hash = []
    for x in l["items"]:
        item_hash = instance_id_to_hash(x['itemInstanceId'])
        if not item_hash:
            items_to_hash.append(x['itemInstanceId'])
        else:
            item_hashes[x['itemInstanceId']] = item_hash
    if items_to_hash:
        async with client.acquire() as rest:
            for item in items_to_hash:
                t = await rest.fetch_item(mem_id, item, user["destinyMemberships"][0]["membershipType"], [aiobungie.ComponentType.ITEM_COMMON_DATA])
                print(t)
    await rest.equip_items(access_token, item_ids, c_id, user["destinyMemberships"][0]["membershipType"])



    # Save current loadout
    # await save_in_game_loadout(client, conn, membership_type, mem_id, character_id, "In-Game PvE Loadout", access_token)
    #
    # # Load saved loadouts
    # loadouts = load_loadouts(conn, mem_id)
    # print("Saved loadouts:", loadouts)
    #
    # # Apply a saved loadout
    # if loadouts:
    #     await apply_loadout(client, loadouts[0], access_token)

    return web.json_response({"message": "Loadout operations completed"})


temp = {'loadouts': [{'colorHash': 1693821595, 'iconHash': 797343703, 'nameHash': 2755629639, 'items': [
    {'itemInstanceId': '6917530083159393753',
     'plugItemHashes': [2166136261, 3525010810, 3492396210, 3528046508, 1906147653, 3683636136, 1334978104, 2166136261,
                        253121539, 2302094943, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261]},
    {'itemInstanceId': '6917530072407232802',
     'plugItemHashes': [2166136261, 3250034553, 2420895100, 984655331, 956288240, 3683636136, 3336648220, 2166136261,
                        4139916815, 905869860, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261]},
    {'itemInstanceId': '6917529947072368109',
     'plugItemHashes': [2166136261, 1478423395, 1380253176, 1679262379, 3465198467, 2166136261, 2931483505, 2166136261,
                        2166136261, 2240097604, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                        2166136261]}, {'itemInstanceId': '6917529862638357113',
                                       'plugItemHashes': [4287799666, 1036557198, 2724068510, 967052942, 3683636136,
                                                          2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                                          2190633952, 2507624050, 3727270518, 2166136261, 2166136261,
                                                          2166136261]}, {'itemInstanceId': '6917529862677541885',
                                                                         'plugItemHashes': [4287799666, 2031584061,
                                                                                            1125523126, 1709236482,
                                                                                            3683636136, 2166136261,
                                                                                            2166136261, 2166136261,
                                                                                            2166136261, 2166136261,
                                                                                            2498589276, 2507624050,
                                                                                            3727270518, 2166136261,
                                                                                            2166136261, 2166136261]},
    {'itemInstanceId': '6917529857835721745',
     'plugItemHashes': [4287799666, 707237917, 3194530172, 3410844187, 3683636136, 2166136261, 2166136261, 2166136261,
                        2166136261, 2166136261, 527001801, 2507624050, 3727270518, 2166136261, 2166136261, 2166136261]},
    {'itemInstanceId': '6917529858150774418',
     'plugItemHashes': [4287799666, 4087056174, 1848187513, 3775916472, 3683636136, 2166136261, 2166136261, 2166136261,
                        2166136261, 2166136261, 1459837414, 2507624050, 3727270518, 2166136261, 2166136261,
                        2166136261]}, {'itemInstanceId': '6917530065581388401',
                                       'plugItemHashes': [4287799666, 11126525, 4160037471, 40751621, 3683636136,
                                                          2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                                          2166136261, 2166136261, 539459624, 702981643, 2166136261,
                                                          2166136261]}, {'itemInstanceId': '6917530019272749883',
                                                                         'plugItemHashes': [2868073563, 266130438,
                                                                                            2529942644, 1980796564,
                                                                                            934199459, 1396318109,
                                                                                            275534325, 1262901523,
                                                                                            1262901520, 2626922120,
                                                                                            124726499, 2626922122,
                                                                                            124726496, 2626922126,
                                                                                            2166136261, 2166136261]}]},
                     {'colorHash': 1693821585, 'iconHash': 797343710, 'nameHash': 2755629642, 'items': [
                         {'itemInstanceId': '6917530083609905605',
                          'plugItemHashes': [2166136261, 3661387068, 2680121939, 1906147653, 1171887445, 4248210736,
                                             1197814525, 2166136261, 3978094547, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530083272240585',
                          'plugItemHashes': [2166136261, 1300023272, 2420895100, 461595545, 788178929, 4248210736,
                                             1197814525, 2166136261, 511914882, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530080600441141',
                          'plugItemHashes': [2166136261, 3525010810, 2822142346, 588594999, 3465198467, 2931483505,
                                             2166136261, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [4287799666, 837201397, 1036557198, 554409585, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 722346046, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4204488676, 1153260021, 3657186535, 1709236482, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 4287182959, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 707237917, 953234331, 953234331, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 128069444, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [1435557120, 4087056174, 877723168, 2734674728, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530083263874132',
                          'plugItemHashes': [4204488676, 4160037471, 11126525, 40751621, 4248210736, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                             4173924323, 702981643, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073563, 266130438, 2529942644, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922126, 124726496, 124726503,
                                             124726499, 2626922124, 2166136261, 2166136261]}]},
                     {'colorHash': 3871954961, 'iconHash': 797343711, 'nameHash': 2755629639, 'items': [
                         {'itemInstanceId': '6917530084817212349',
                          'plugItemHashes': [2166136261, 3250034553, 106909392, 691659142, 4082225868, 4248210736,
                                             2323986101, 2166136261, 2838996248, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530066902956258',
                          'plugItemHashes': [2166136261, 1478423395, 2822142346, 536173722, 2675184851, 4248210736,
                                             1197814525, 2166136261, 253121539, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529907936203017',
                          'plugItemHashes': [2166136261, 1467527085, 3868766766, 25692695, 3465198467, 2166136261,
                                             2931483505, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [4287799666, 1036557198, 3926119246, 3000428062, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2190633952, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4287799666, 2031584061, 4244246940, 1709236482, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2498589276, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 3719981603, 3194530172, 3194530172, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 527001801, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [4287799666, 4087056174, 1848187513, 3775916472, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530061799875703',
                          'plugItemHashes': [1435557120, 4004774872, 11126525, 40751621, 2653012761, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                             199176566, 702981643, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073560, 266130438, 2529942645, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922120, 124726499, 2626922122,
                                             124726496, 2626922126, 2166136261, 2166136261]}]},
                     {'colorHash': 1693821595, 'iconHash': 1143786709, 'nameHash': 752612097, 'items': [
                         {'itemInstanceId': '6917530083609905605',
                          'plugItemHashes': [2166136261, 3661387068, 2680121939, 1906147653, 1171887445, 4248210736,
                                             1197814525, 2166136261, 3978094547, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529932302510737',
                          'plugItemHashes': [2166136261, 1478423395, 2005566727, 1992365846, 990298390, 2166136261,
                                             2166136261, 2931483505, 2166136261, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530061925670104',
                          'plugItemHashes': [2166136261, 1478423395, 1380253176, 2817499044, 3744057135, 4248210736,
                                             3336648220, 2166136261, 2041432007, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [1703647492, 3832366019, 2595839237, 554409585, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 722346046, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4204488676, 1153260021, 3657186535, 1709236482, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 4287182959, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 707237917, 953234331, 3194530172, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 128069444, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [1435557120, 4087056174, 1097608874, 877723168, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530061799875703',
                          'plugItemHashes': [1435557120, 4004774872, 11126525, 40751621, 2653012761, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                             199176566, 702981643, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073560, 266130438, 2529942644, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922126, 124726496, 124726503,
                                             124726499, 2626922124, 2166136261, 2166136261]}]},
                     {'colorHash': 1693821590, 'iconHash': 797343699, 'nameHash': 2755629643, 'items': [
                         {'itemInstanceId': '6917530084817212349',
                          'plugItemHashes': [2166136261, 3250034553, 106909392, 691659142, 4082225868, 4248210736,
                                             2323986101, 2166136261, 2838996248, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530066902956258',
                          'plugItemHashes': [2166136261, 1478423395, 2822142346, 536173722, 2675184851, 4248210736,
                                             1197814525, 2166136261, 253121539, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529907936203017',
                          'plugItemHashes': [2166136261, 1467527085, 3868766766, 25692695, 3465198467, 2166136261,
                                             2931483505, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [4287799666, 1036557198, 3926119246, 3000428062, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2190633952, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4287799666, 2031584061, 4244246940, 1709236482, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2498589276, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 707237917, 3194530172, 3410844187, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 527001801, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [1980618587, 3467460423, 3467460423, 3467460423, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530084666665712',
                          'plugItemHashes': [1237786518, 11126525, 1755737153, 1755737153, 4248210736, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                             4173924323, 702981643, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073563, 266130438, 2529942645, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922120, 124726499, 2626922122,
                                             124726496, 2626922126, 2166136261, 2166136261]}]},
                     {'colorHash': 3871954960, 'iconHash': 797343703, 'nameHash': 2755629643, 'items': [
                         {'itemInstanceId': '6917530083159393753',
                          'plugItemHashes': [2166136261, 3525010810, 3492396210, 3528046508, 1906147653, 3683636136,
                                             1334978104, 2166136261, 253121539, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529932302510737',
                          'plugItemHashes': [2166136261, 1478423395, 2005566727, 1992365846, 990298390, 2166136261,
                                             2166136261, 2931483505, 2166136261, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530061925670104',
                          'plugItemHashes': [2166136261, 1478423395, 1380253176, 2817499044, 3744057135, 4248210736,
                                             3336648220, 2166136261, 2041432007, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [1703647492, 1036557198, 1036557198, 1036557198, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 722346046, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4204488676, 1709236482, 1709236482, 1709236482, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 4287182959, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 3719981603, 3410844187, 3410844187, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 128069444, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [1980618587, 2921714558, 2921714558, 2921714558, 3280430051, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 199176566,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530084666665712',
                          'plugItemHashes': [1237786518, 11126525, 1755737153, 1755737153, 4248210736, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                             4173924323, 702981643, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073563, 266130438, 2529942644, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922126, 124726496, 124726503,
                                             124726499, 2626922124, 2166136261, 2166136261]}]},
                     {'colorHash': 3871954964, 'iconHash': 1143786718, 'nameHash': 752612096, 'items': [
                         {'itemInstanceId': '6917530084817212349',
                          'plugItemHashes': [2166136261, 3250034553, 106909392, 691659142, 4082225868, 4248210736,
                                             2323986101, 2166136261, 2838996248, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530080132347240',
                          'plugItemHashes': [2166136261, 1478423395, 2822142346, 1906147653, 984655331, 4248210736,
                                             2400144052, 2166136261, 4139916815, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529947072368109',
                          'plugItemHashes': [2166136261, 1478423395, 1380253176, 1679262379, 3465198467, 2166136261,
                                             2931483505, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [4287799666, 1274140735, 554409585, 1388734897, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2190633952, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4287799666, 2031584061, 2586562813, 1709236482, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2498589276, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 707237917, 3194530172, 3410844187, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 527001801, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [4287799666, 4087056174, 2734674728, 4087056174, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530065581388401',
                          'plugItemHashes': [4287799666, 11126525, 4004774872, 40751621, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                             539459624, 702981643, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073563, 266130438, 2529942644, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922120, 124726499, 2626922122,
                                             124726496, 2626922126, 2166136261, 2166136261]}]},
                     {'colorHash': 1693821594, 'iconHash': 797343697, 'nameHash': 752612102, 'items': [
                         {'itemInstanceId': '6917530075532479602',
                          'plugItemHashes': [2166136261, 1844523823, 1087426260, 3291427296, 344235611, 4248210736,
                                             1197814525, 2166136261, 3989629871, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530080132347240',
                          'plugItemHashes': [2166136261, 1478423395, 2822142346, 1906147653, 984655331, 4248210736,
                                             2400144052, 2166136261, 4139916815, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529907936203017',
                          'plugItemHashes': [2166136261, 1467527085, 3868766766, 25692695, 3465198467, 2166136261,
                                             2931483505, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [2639422088, 1036557198, 4255093903, 3832366019, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2190633952, 3160845295,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [2532323436, 1709236482, 1079896271, 1079896271, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2498589276, 539459624,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 3194530172, 3719981603, 3410844187, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 527001801, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [4287799666, 4087056174, 688956976, 877723168, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 3160845295,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530061799875703',
                          'plugItemHashes': [4287799666, 40751621, 11126525, 4160037471, 2653012761, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                             199176566, 702981643, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073560, 266130438, 2529942645, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 124726503, 124726502, 124726496,
                                             124726499, 2626922122, 2166136261, 2166136261]}]},
                     {'colorHash': 1693821586, 'iconHash': 797343697, 'nameHash': 2755629635, 'items': [
                         {'itemInstanceId': '6917530084817212349',
                          'plugItemHashes': [2166136261, 3250034553, 106909392, 691659142, 4082225868, 4248210736,
                                             2323986101, 2166136261, 2838996248, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530080132347240',
                          'plugItemHashes': [2166136261, 1478423395, 2822142346, 1906147653, 984655331, 4248210736,
                                             2400144052, 2166136261, 4139916815, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529947072368109',
                          'plugItemHashes': [2166136261, 1478423395, 1380253176, 1679262379, 3465198467, 2166136261,
                                             2931483505, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [2724608735, 1036557198, 1388734897, 2467203039, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2190633952, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [2724608735, 2031584061, 2586562813, 1709236482, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2498589276, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529844818135345',
                          'plugItemHashes': [2724608735, 953234331, 953234331, 3194530172, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 702981643, 4235122381,
                                             199176566, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [1980618587, 2319885414, 2319885414, 2319885414, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 3160845295,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858128916469',
                          'plugItemHashes': [1980618587, 1755737153, 1755737153, 11126525, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 4056052795, 3160845295,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073563, 266130438, 2529942644, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922120, 124726499, 2626922122,
                                             124726496, 2626922126, 2166136261, 2166136261]}]},
                     {'colorHash': 3871954962, 'iconHash': 1143786719, 'nameHash': 752612098, 'items': [
                         {'itemInstanceId': '6917529956034872675',
                          'plugItemHashes': [2166136261, 1047830412, 1087426260, 536173722, 788178929, 4248210736,
                                             1334978104, 2166136261, 1156201379, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530072407232802',
                          'plugItemHashes': [2166136261, 3250034553, 2420895100, 984655331, 956288240, 3683636136,
                                             3336648220, 2166136261, 4139916815, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530020135994275',
                          'plugItemHashes': [2166136261, 3250034553, 2680121939, 877533329, 990298390, 2166136261,
                                             2931483505, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [4287799666, 1036557198, 2724068510, 967052942, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2190633952, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4287799666, 2031584061, 1125523126, 1709236482, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2498589276, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 707237917, 3194530172, 3410844187, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 527001801, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [4287799666, 4087056174, 1848187513, 3775916472, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530065581388401',
                          'plugItemHashes': [4287799666, 11126525, 4004774873, 40751621, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2166136261, 2166136261,
                                             539459624, 702981643, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073563, 266130438, 2529942644, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922120, 124726499, 2626922122,
                                             124726496, 2626922126, 2166136261, 2166136261]}]},
                     {'colorHash': 1693821589, 'iconHash': 1143786718, 'nameHash': 2755629643, 'items': [
                         {'itemInstanceId': '6917530083159393753',
                          'plugItemHashes': [2166136261, 3525010810, 3492396210, 3528046508, 1906147653, 3683636136,
                                             1334978104, 2166136261, 253121539, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530072407232802',
                          'plugItemHashes': [2166136261, 3250034553, 2420895100, 984655331, 956288240, 3683636136,
                                             3336648220, 2166136261, 4139916815, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529947072368109',
                          'plugItemHashes': [2166136261, 1478423395, 1380253176, 1679262379, 3465198467, 2166136261,
                                             2931483505, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529945000470465',
                          'plugItemHashes': [1180408010, 3832366019, 3938489430, 1305536863, 4248210736, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 702981643, 3662465907,
                                             4173924323, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4287799666, 2447449706, 2657604783, 3685945823, 3470260969, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 59499292, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529857835721745',
                          'plugItemHashes': [4287799666, 707237917, 3194530172, 3410844187, 3470260969, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1837686788, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [4287799666, 4087056174, 1848187513, 3775916472, 3470260969, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 3357394598, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858128916469',
                          'plugItemHashes': [1180408010, 40751621, 4160037471, 11126525, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 4056052795, 3160845295,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529810513379145',
                          'plugItemHashes': [489583097, 1698387815, 119041298, 2708585276, 1713935764, 1656549675,
                                             1656549674, 1727069366, 3277705906, 1727069362, 1727069363, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]}]},
                     {'colorHash': 1693821584, 'iconHash': 797343703, 'nameHash': 2755629635, 'items': [
                         {'itemInstanceId': '6917529956034872675',
                          'plugItemHashes': [2166136261, 1047830412, 1087426260, 536173722, 788178929, 4248210736,
                                             1334978104, 2166136261, 1156201379, 2302094943, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530072407232802',
                          'plugItemHashes': [2166136261, 3250034553, 2420895100, 984655331, 956288240, 3683636136,
                                             3336648220, 2166136261, 4139916815, 905869860, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530020135994275',
                          'plugItemHashes': [2166136261, 3250034553, 2680121939, 877533329, 990298390, 2166136261,
                                             2931483505, 2166136261, 2166136261, 2240097604, 2166136261, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862638357113',
                          'plugItemHashes': [4287799666, 1036557198, 2724068510, 967052942, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2190633952, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529862677541885',
                          'plugItemHashes': [4287799666, 2031584061, 1125523126, 1709236482, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 2498589276, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529844818135345',
                          'plugItemHashes': [4287799666, 953234331, 953234331, 707237917, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 702981643, 4235122381,
                                             199176566, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858150774418',
                          'plugItemHashes': [1980618587, 14520248, 14520248, 14520248, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 1459837414, 2507624050,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917529858128916469',
                          'plugItemHashes': [1980618587, 1755737153, 1755737153, 11126525, 3683636136, 2166136261,
                                             2166136261, 2166136261, 2166136261, 2166136261, 4056052795, 3160845295,
                                             3727270518, 2166136261, 2166136261, 2166136261]},
                         {'itemInstanceId': '6917530019272749883',
                          'plugItemHashes': [2868073563, 266130438, 2529942644, 1980796564, 934199459, 1396318109,
                                             275534325, 1262901523, 1262901520, 2626922120, 124726499, 2626922122,
                                             124726496, 2626922126, 2166136261, 2166136261]}]}]}
